<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Sweet Surprise for You</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@300;500&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background: radial-gradient(circle at center, #2e1510 0%, #050202 100%);
            font-family: 'Montserrat', sans-serif;
            color: white;
            touch-action: none; 
            -webkit-tap-highlight-color: transparent;
        }

        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 30px 20px;
            box-sizing: border-box;
            z-index: 5;
            opacity: 0;
            transition: opacity 1s;
        }

        header { text-align: center; }
        h1 {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2.2rem, 8vw, 3.5rem);
            margin: 0;
            background: linear-gradient(to bottom, #ff9a9e, #fecfef);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px rgba(255, 105, 180, 0.5));
        }

        .controls {
            pointer-events: auto;
            display: flex;
            justify-content: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 20px;
            border-radius: 50px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            margin: 0 auto 20px auto;
            width: fit-content;
        }

        .flavor-btn {
            width: 38px; height: 38px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .flavor-btn.active { border-color: #fff; transform: scale(1.25); box-shadow: 0 0 15px rgba(255,255,255,0.4); }
        .f-dark { background: #2b110a; }
        .f-milk { background: #7b4422; }
        .f-white { background: #fdf5e6; }
        .f-pink { background: #ffb7c5; }

        #hint {
            text-align: center;
            font-size: 0.85rem;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.6);
            animation: pulse 2s infinite;
        }

        #final-card {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.7);
            width: 85%; max-width: 380px;
            background: rgba(15, 5, 5, 0.95);
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            border: 1px solid rgba(255, 215, 0, 0.4);
            box-shadow: 0 0 50px rgba(0, 0, 0, 1);
            opacity: 0;
            pointer-events: none;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
        }
        
        #final-card.visible { opacity: 1; transform: translate(-50%, -50%) scale(1); pointer-events: auto; }

        #start-screen {
            position: fixed; inset: 0;
            background: #050202;
            z-index: 999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s ease;
        }

        .btn-fancy {
            background: linear-gradient(45deg, #ff69b4, #ff1493);
            border: none; color: white; padding: 16px 45px;
            border-radius: 50px; font-size: 1.1rem; font-weight: bold;
            box-shadow: 0 10px 20px rgba(255,20,147,0.3);
            cursor: pointer;
            animation: bounce 2s infinite;
        }

        @keyframes bounce { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-10px);} }
        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="margin-bottom: 25px;">Something Sweet...</h1>
        <button class="btn-fancy" onclick="startApp()">Open My Heart</button>
    </div>

    <div id="ui-layer">
        <header>
            <h1>Happy Chocolate Day</h1>
            <p style="color: #ff9eb5; letter-spacing: 3px; font-size: 0.7rem;">SWEETER THAN ANYTHING ELSE</p>
        </header>
        <div id="hint">Tap the heart to take a bite...</div>
        <div class="controls">
            <div class="flavor-btn f-dark active" onclick="setFlavor('dark', this)"></div>
            <div class="flavor-btn f-milk" onclick="setFlavor('milk', this)"></div>
            <div class="flavor-btn f-white" onclick="setFlavor('white', this)"></div>
            <div class="flavor-btn f-pink" onclick="setFlavor('pink', this)"></div>
        </div>
    </div>

    <div id="final-card">
        <h2 style="font-family: 'Dancing Script'; font-size: 2.2rem; color: #ffd700; margin-bottom: 10px;">You're the One</h2>
        <p style="color: #eee; line-height: 1.7; font-size: 0.95rem;">
            I searched for the finest chocolate,<br> but nothing is as sweet as you.<br><br>
            <b>Will you be my Valentine?</b> ❤️
        </p>
        <button class="btn-fancy" style="margin-top: 25px; padding: 10px 30px; font-size: 0.8rem;" onclick="location.reload()">Replay</button>
    </div>

    <div id="canvas-container"></div>
    <audio id="bg-music" loop><source src="song.mp3" type="audio/mpeg"></audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, heartMesh, innerSurprise, raycaster, mouse;
        let particles = [], backgroundHearts = [];
        let bites = 0, maxBites = 7, isComplete = false;
        let currentScale = 1;

        const materials = {
            dark: new THREE.MeshPhysicalMaterial({ color: 0x2b110a, roughness: 0.15, metalness: 0.4, clearcoat: 1 }),
            milk: new THREE.MeshPhysicalMaterial({ color: 0x7b4422, roughness: 0.2, metalness: 0.2, clearcoat: 0.8 }),
            white: new THREE.MeshPhysicalMaterial({ color: 0xfdf5e6, roughness: 0.3, metalness: 0.1, clearcoat: 0.5 }),
            pink: new THREE.MeshPhysicalMaterial({ color: 0xffb7c5, roughness: 0.2, metalness: 0.1, clearcoat: 0.7 })
        };

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 24;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            const ambient = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambient);
            const mainLight = new THREE.PointLight(0xffffff, 1.5);
            mainLight.position.set(15, 15, 15);
            scene.add(mainLight);

            createHeart();
            createInnerSurprise();
            createBackgroundHearts();

            window.addEventListener('mousedown', (e) => handleInput(e.clientX, e.clientY));
            window.addEventListener('touchstart', (e) => handleInput(e.touches[0].clientX, e.touches[0].clientY));
            window.addEventListener('resize', onResize);
            animate();
        }

        function createHeart() {
            const shape = new THREE.Shape();
            shape.moveTo(0, 0);
            shape.bezierCurveTo(0, -3.7, -7, -3.7, -7, 1.5); 
            shape.bezierCurveTo(-7, 5.5, -2, 7.7, 0, 11);     
            shape.bezierCurveTo(2, 7.7, 7, 5.5, 7, 1.5);      
            shape.bezierCurveTo(7, -3.7, 0, -3.7, 0, 0);      

            const extrudeSettings = { depth: 2.5, bevelEnabled: true, bevelSegments: 20, bevelSize: 1.2, bevelThickness: 1.2 };
            const geometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
            geometry.center();

            heartMesh = new THREE.Mesh(geometry, materials.dark);
            heartMesh.rotation.x = Math.PI;
            scene.add(heartMesh);
        }

        function createInnerSurprise() {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 512;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#111'; ctx.fillRect(0,0,512,512);
            ctx.strokeStyle = '#ffd700'; ctx.lineWidth = 20; ctx.strokeRect(30,30,452,452);
            ctx.fillStyle = '#ffd700'; ctx.font = 'bold 70px Arial'; ctx.textAlign = 'center';
            ctx.fillText('YOU FOUND', 256, 210);
            ctx.font = 'bold 90px Arial';
            ctx.fillText('MY HEART', 256, 330);
            
            const texture = new THREE.CanvasTexture(canvas);
            innerSurprise = new THREE.Mesh(
                new THREE.BoxGeometry(5, 5, 5),
                new THREE.MeshStandardMaterial({ map: texture, emissive: 0xffd700, emissiveIntensity: 0 })
            );
            innerSurprise.visible = false;
            scene.add(innerSurprise);
        }

        function createBackgroundHearts() {
            const geo = new THREE.SphereGeometry(0.12, 8, 8);
            const mat = new THREE.MeshBasicMaterial({ color: 0xff69b4, transparent: true, opacity: 0.5 });
            for(let i=0; i<60; i++) {
                const p = new THREE.Mesh(geo, mat);
                p.position.set((Math.random()-0.5)*50, (Math.random()-0.5)*50, (Math.random()-0.5)*25);
                scene.add(p);
                backgroundHearts.push(p);
            }
        }

        function handleInput(x, y) {
            if (isComplete) return;
            mouse.x = (x / window.innerWidth) * 2 - 1;
            mouse.y = -(y / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObject(heartMesh);
            if (intersects.length > 0) takeBite(intersects[0].point);
        }

        function takeBite(point) {
            bites++;
            spawnParticles(point, 15, heartMesh.material.color);
            currentScale *= 0.82;
            
            if (bites >= maxBites) {
                isComplete = true;
                scene.remove(heartMesh);
                innerSurprise.visible = true;
                innerSurprise.material.emissiveIntensity = 1.5;
                spawnParticles(new THREE.Vector3(0,0,0), 120, 0xffd700); 
                document.getElementById('final-card').classList.add('visible');
                document.getElementById('hint').style.display = 'none';
            }
        }

        function spawnParticles(pos, count, color) {
            const geo = new THREE.IcosahedronGeometry(0.25, 0);
            const mat = new THREE.MeshBasicMaterial({ color: color });
            for(let i=0; i<count; i++) {
                const p = new THREE.Mesh(geo, mat);
                p.position.copy(pos);
                p.velocity = new THREE.Vector3((Math.random()-0.5)*0.6, (Math.random()-0.5)*0.6, Math.random()*0.6);
                scene.add(p);
                particles.push(p);
            }
        }

        function startApp() {
            document.getElementById('start-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('ui-layer').style.opacity = '1';
            }, 800);
            document.getElementById('bg-music').play().catch(() => {});
            init();
        }

        function setFlavor(type, btn) {
            document.querySelectorAll('.flavor-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            heartMesh.material = materials[type];
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const t = Date.now() * 0.001;

            if (heartMesh && !isComplete) {
                const heartbeat = 1 + Math.sin(t * 4) * 0.03;
                heartMesh.scale.set(currentScale * heartbeat, currentScale * heartbeat, currentScale * heartbeat);
                heartMesh.rotation.y = Math.sin(t * 0.5) * 0.2;
                heartMesh.position.y = Math.sin(t * 1.5) * 0.4;
            }
            if (innerSurprise) {
                innerSurprise.rotation.y += 0.015;
                innerSurprise.rotation.z += 0.005;
            }

            backgroundHearts.forEach(p => {
                p.position.y += 0.025;
                if (p.position.y > 25) p.position.y = -25;
            });

            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.position.add(p.velocity);
                p.scale.multiplyScalar(0.95);
                if (p.scale.x < 0.01) { scene.remove(p); particles.splice(i, 1); }
            }
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>